<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë‹¨ë§ê¸° êµ¬ë§¤ ì‹œë®¬ë ˆì´ì…˜</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      padding: 40px;
      background-color: #f8f9fa;
    }
    h2,
    h3 {
      margin-top: 20px;
    }
    label {
      font-weight: bold;
      margin-top: 10px;
    }
    canvas {
      margin-top: 40px;
    }
    .form-control {
      max-width: 200px;
      display: inline-block;
    }
    .section-box {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2 class="text-center mb-4">ğŸ“± ë‹¨ë§ê¸° êµ¬ë§¤ë¹„ìš© ì‹œë®¬ë ˆì´í„°</h2>

    <div class="section-box">
      <h4>ìê¸‰ì œ + ì•Œëœ°í°</h4>
      <div class="mb-2">
        <label>ìê¸‰ì œ ë‹¨ë§ê¸° ê°€ê²©:</label>
        <input
          type="number"
          id="unlockedPrice"
          class="form-control"
          value="1000000"
        />
      </div>
      <div class="mb-2">
        <label>ì•Œëœ°í° ì›” í†µì‹ ìš”ê¸ˆ:</label>
        <input
          type="number"
          id="mvnoMonthly"
          class="form-control"
          value="20000"
        />
      </div>
    </div>

    <div class="section-box">
      <h4>ì´í†µì‚¬ ë²ˆí˜¸ì´ë™</h4>
      <div class="mb-2">
        <label>í• ë¶€ì›ê¸ˆ:</label>
        <input type="number" id="carrierPrice" class="form-control" value="800000" />
      </div>
      <div class="mb-2">
        <label>6ê°œì›” ê³ ê°€ ìš”ê¸ˆì œ:</label>
        <input type="number" id="carrierHighPlan" class="form-control" value="80000" />
      </div>
      <div class="mb-2">
        <label>7~24ê°œì›” ìš”ê¸ˆì œ:</label>
        <input type="number" id="carrierLowPlan" class="form-control" value="40000" />
      </div>
      <div class="mb-2">
        <label>25ê°œì›” ì´í›„ ìš”ê¸ˆì œ (ì„ íƒì•½ì • 25% í• ì¸ ì ìš©):</label>
        <input
          type="number"
          id="carrierDiscountedPlan"
          class="form-control"
          value="30000"
        />
      </div>
    </div>

    <div class="section-box">
      <h4>ì„ íƒì•½ì • + ë¹„ê³µì‹ ë³´ì¡°ê¸ˆ</h4>
      <div class="mb-2">
        <label>ê¸°ê¸° ì •ê°€:</label>
        <input type="number" id="customPrice" class="form-control" value="1000000" />
      </div>
      <div class="mb-2">
        <label>ë§¤ì¥ í• ì¸(ë¹„ê³µì‹ ë³´ì¡°ê¸ˆ):</label>
        <input
          type="number"
          id="customDiscount"
          class="form-control"
          value="200000"
        />
      </div>
      <div class="mb-2">
        <label>ìš”ê¸ˆì œ ì›ê¸ˆ(í• ì¸ ì „):</label>
        <input
          type="number"
          id="customPlanBefore"
          class="form-control"
          value="60000"
        />
      </div>
    </div>

    <div class="mb-3">
<label>ë¹„êµí•  ê°œì›” ìˆ˜ (1 ì´ìƒ):</label>
<input type="number" id="monthsToCompare" class="form-control" value="60" min="1" />

</div>

    <div class="text-center mb-4">
      <button class="btn btn-primary" onclick="calculate()">ğŸ“Š ë¹„êµí•˜ê¸°</button>
      <button class="btn btn-outline-secondary" onclick="window.print()">
        ğŸ–¨ PDFë¡œ ì¶œë ¥
      </button>
      <button class="btn btn-success" onclick="downloadCSV()">â¬‡ï¸ CSV ë‹¤ìš´ë¡œë“œ</button>
    </div>

    <div id="result" class="table-responsive"></div>
    <canvas id="costChart" height="100"></canvas>
  </div>

  <script>
    function calculate() {
      const monthsToCompareInput = parseInt(document.getElementById('monthsToCompare').value);
      const monthsToCompare = (monthsToCompareInput >= 1) ? monthsToCompareInput : 60;


      const unlockedPrice = parseInt(document.getElementById("unlockedPrice").value);
      const mvnoMonthly = parseInt(document.getElementById("mvnoMonthly").value);
      const carrierPrice = parseInt(document.getElementById("carrierPrice").value);
      const carrierHighPlan = parseInt(document.getElementById("carrierHighPlan").value);
      const carrierLowPlan = parseInt(document.getElementById("carrierLowPlan").value);
      const carrierDiscountedPlan = parseInt(
        document.getElementById("carrierDiscountedPlan").value
      );

      const customPrice = parseInt(document.getElementById("customPrice").value);
      const customDiscount = parseInt(document.getElementById("customDiscount").value);
      const customPlanBefore = parseInt(
        document.getElementById("customPlanBefore").value
      );
      const customPlanAfter = Math.round(customPlanBefore * 0.75);

      let result =
        '<table class="table table-bordered table-striped"><thead class="table-light"><tr><th>ì›”</th><th>ìê¸‰ì œ+ì•Œëœ°í°</th><th>ì´í†µì‚¬ ë²ˆí˜¸ì´ë™</th><th>ì„ íƒì•½ì •+ë§¤ì¥ë³´ì¡°ê¸ˆ</th><th>ê°€ì¥ ìœ ë¦¬í•œ ì„ íƒ</th></tr></thead><tbody>';

      const mvnoTotals = [];
      const carrierTotals = [];
      const customTotals = [];
      const labels = [];

      let mvnoTotal = unlockedPrice;
      let carrierTotal = carrierPrice;
      let customTotal = customPrice - customDiscount;

      for (let month = 1; month <= monthsToCompare; month++) {
        mvnoTotal += mvnoMonthly;

        if (month <= 6) {
          carrierTotal += carrierHighPlan;
        } else if (month <= 24) {
          carrierTotal += carrierLowPlan;
        } else {
          carrierTotal += carrierDiscountedPlan;
        }

        customTotal += customPlanAfter;

        mvnoTotals.push(mvnoTotal);
        carrierTotals.push(carrierTotal);
        customTotals.push(customTotal);
        labels.push(month + "ì›”");

        const minCost = Math.min(mvnoTotal, carrierTotal, customTotal);
        let best = "ìê¸‰ì œ+ì•Œëœ°í°";
        if (minCost === carrierTotal) best = "ì´í†µì‚¬ ë²ˆí˜¸ì´ë™";
        else if (minCost === customTotal) best = "ì„ íƒì•½ì •+ë§¤ì¥ë³´ì¡°ê¸ˆ";

        result += `<tr><td>${month}</td>
          <td>${unlockedPrice.toLocaleString()} + ${(mvnoTotal - unlockedPrice).toLocaleString()} = ${mvnoTotal.toLocaleString()}ì›</td>
          <td>${carrierPrice.toLocaleString()} + ${(carrierTotal - carrierPrice).toLocaleString()} = ${carrierTotal.toLocaleString()}ì›</td>
          <td>${(customPrice - customDiscount).toLocaleString()} + ${(customTotal - (customPrice - customDiscount)).toLocaleString()} = ${customTotal.toLocaleString()}ì›</td>
          <td>${best}</td>
          </tr>`;
      }

      result += "</tbody></table>";
      document.getElementById("result").innerHTML = result;

      const ctx = document.getElementById("costChart").getContext("2d");
      if (window.costChart) window.costChart.destroy();
      window.costChart = new Chart(ctx, {
        type: "line",
        data: {
          labels: labels,
          datasets: [
            {
              label: "ìê¸‰ì œ+ì•Œëœ°í°",
              data: mvnoTotals,
              borderColor: "blue",
              backgroundColor: "blue",
              fill: false,
              tension: 0.1,
            },
            {
              label: "ì´í†µì‚¬ ë²ˆí˜¸ì´ë™",
              data: carrierTotals,
              borderColor: "red",
              backgroundColor: "red",
              fill: false,
              tension: 0.1,
            },
            {
              label: "ì„ íƒì•½ì •+ë§¤ì¥ë³´ì¡°ê¸ˆ",
              data: customTotals,
              borderColor: "green",
              backgroundColor: "green",
              fill: false,
              tension: 0.1,
            },
          ],
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: "top" },
            title: { display: true, text: "ëˆ„ì  ë¹„ìš© ë¹„êµ (ì›”ë³„)" },
          },
        },
      });
    }

    function downloadCSV() {
  const rows = [];
  // í…Œì´ë¸” í—¤ë”
  const headers = ["ì›”", "ìê¸‰ì œ+ì•Œëœ°í°", "ì´í†µì‚¬ ë²ˆí˜¸ì´ë™", "ì„ íƒì•½ì •+ë§¤ì¥ë³´ì¡°ê¸ˆ", "ê°€ì¥ ìœ ë¦¬í•œ ì„ íƒ"];
  rows.push(headers.join(","));

  // í…Œì´ë¸” í–‰ ë°ì´í„° ì¶”ì¶œ
  const tableRows = document.querySelectorAll("#result table tbody tr");
  tableRows.forEach(tr => {
    const cols = [...tr.querySelectorAll("td")].map(td => `"${td.textContent.trim()}"`);
    rows.push(cols.join(","));
  });

  // CSV í…ìŠ¤íŠ¸ ìƒì„±

const csvString = "\uFEFF" + rows.join("\n");
const blob = new Blob([csvString], { type: "text/csv;charset=utf-8;" });


  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "mobile_plan_comparison.csv";
  link.style.display = "none";
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

  </script>
</body>
</html>
